From 7cb4ac875bd30b8653f819d1730f6496f6d07351 Mon Sep 17 00:00:00 2001
From: "sun.cwsun" <sun.cwsun@inventec.com>
Date: Tue, 6 Dec 2022 15:05:05 +0800
Subject: [PATCH] Bug 1387 - [Transformers][OpenBMC][IPMI] Set vlan id command
 failed

---
 src/vlan_interface.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/vlan_interface.cpp b/src/vlan_interface.cpp
index 95e199b..cd55d7c 100644
--- a/src/vlan_interface.cpp
+++ b/src/vlan_interface.cpp
@@ -21,6 +21,11 @@ namespace network
 using namespace phosphor::logging;
 using namespace sdbusplus::xyz::openbmc_project::Common::Error;
 
+//cwsun: The emitSignal config false will cause the MapperObject
+// get the wrong status of vlan object. It should always be true
+// Before openbmc v2.8. The EthernetInterface always treat the emitSignal as true.
+// But in openbmc v2.12. The emitSignal will using 4 state and not using bool type.
+// The true value here will use defer_emit state to send the signal.
 VlanInterface::VlanInterface(sdbusplus::bus::bus& bus,
                              const std::string& objPath, DHCPConf dhcpEnabled,
                              bool nicEnabled, uint32_t vlanID,
@@ -28,7 +33,7 @@ VlanInterface::VlanInterface(sdbusplus::bus::bus& bus,
                              uint8_t vlanPriority) :
     VlanIface(bus, objPath.c_str()),
     DeleteIface(bus, objPath.c_str()),
-    EthernetInterface(bus, objPath, dhcpEnabled, parent, /*emitSignal=*/false,
+    EthernetInterface(bus, objPath, dhcpEnabled, parent, /*emitSignal=*/true,
                       nicEnabled),
     parentInterface(intf)
 {
